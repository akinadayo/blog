---
import BaseLayout from './BaseLayout.astro';
import { PostHeader } from '../components/PostHeader';
import { PostFooter } from '../components/PostFooter';

interface Props {
  title: string;
  description?: string;
  pubDate: Date;
  category: string;
  tags?: string[];
  coverImage?: string;
  slug: string;
}

const { title, description, pubDate, category, tags = [], coverImage, slug } = Astro.props;

const formattedDate = pubDate.toLocaleDateString('ja-JP', {
  year: 'numeric',
  month: 'long',
  day: 'numeric',
});
---

<BaseLayout title={title} description={description} currentPage="post">
  <div class="min-h-screen">
    <PostHeader
      client:load
      title={title}
      category={category}
      date={formattedDate}
      tags={tags}
      slug={slug}
    />

    <div class="container max-w-4xl mx-auto px-6 py-16">
      <article class="prose prose-neutral md:prose-lg dark:prose-invert max-w-none leading-relaxed prose-headings:font-black prose-headings:tracking-tight prose-a:text-primary prose-a:no-underline hover:prose-a:underline prose-img:rounded-2xl prose-img:w-auto prose-img:max-w-full prose-img:h-auto prose-img:mx-auto prose-code:text-primary prose-code:bg-primary/10 prose-code:px-1.5 prose-code:py-0.5 prose-code:rounded">
        <slot />
      </article>

      <hr class="my-16 border-border" />

      <PostFooter client:load />
    </div>
  </div>

  <!-- Mermaid対応 -->
  <script type="module">
    import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
    mermaid.initialize({
      startOnLoad: true,
      theme: 'dark',
      themeVariables: {
        primaryColor: '#a855f7',
        primaryTextColor: '#f0f0f0',
        primaryBorderColor: '#a855f7',
        lineColor: '#888',
        secondaryColor: '#1a1a24',
        tertiaryColor: '#12121a'
      }
    });

    // ```mermaid コードブロックを変換
    document.querySelectorAll('pre code.language-mermaid').forEach((block) => {
      const pre = block.parentElement;
      const div = document.createElement('div');
      div.className = 'mermaid';
      div.textContent = block.textContent;
      pre.parentNode.replaceChild(div, pre);
    });

    mermaid.run();
  </script>
</BaseLayout>
